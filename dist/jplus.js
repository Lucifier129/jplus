/* jplus 2014-11-18 */
(function(t,e){"use strict";function n(t){return i(r(t))}function r(t){var e=O(t).match(x);return j(e,function(t,n){var r=e[t]=O(n).match(M);r[0]=O(r[0]),r[1]&&(r[1]=O(r[1])),-1!==r[0].indexOf("-")&&(r[0]=O(r[0]).match(N))})}function i(e){var n={};return j(e,function(){var e=this;switch(!0){case 1===e.length:n[e[0]]={};break;case b(e[0]):n[e[1]]={method:e[0][0],args:e[0].slice(1)};break;case e[0]in t.fn:n[e[1]]={method:e[0],args:v};break;default:n[e[0]]={}}}),n}function o(t){return new o.init(t)}function s(t,e){if(!e(t))for(t=t.firstChild;t;)s(t,e),t=t.nextSibling}function u(){var e=S(t.fn);return e.length=0,e}function a(e){if(!b(e))return!1;var n,r,i=e.length;if(i>1){for(n=t.type(e[0]),r=i-1;r>=0;r--)if(t.type(e[r])!==n)return!1;return!0}return!1}function c(){function t(e,n){var o;if(isNaN(e)&&isNaN(n)&&"number"==typeof e&&"number"==typeof n)return!0;if(e===n)return!0;if("function"==typeof e&&"function"==typeof n||e instanceof Date&&n instanceof Date||e instanceof RegExp&&n instanceof RegExp||e instanceof String&&n instanceof String||e instanceof Number&&n instanceof Number)return""+e==""+n;if(!(e instanceof Object&&n instanceof Object))return!1;if(e.isPrototypeOf(n)||n.isPrototypeOf(e))return!1;if(e.constructor!==n.constructor)return!1;if(e.prototype!==n.prototype)return!1;if(P(e,r)>-1||P(n,i)>-1)return!1;for(o in n){if(n.hasOwnProperty(o)!==e.hasOwnProperty(o))return!1;if(typeof n[o]!=typeof e[o])return!1}for(o in e){if(n.hasOwnProperty(o)!==e.hasOwnProperty(o))return!1;if(typeof n[o]!=typeof e[o])return!1;switch(typeof e[o]){case"object":case"function":if(r.push(e),i.push(n),!t(e[o],n[o]))return!1;r.pop(),i.pop();break;default:if(e[o]!==n[o])return!1}}return!0}var e,n,r,i;if(1>arguments.length)return!0;for(e=1,n=arguments.length;n>e;e++)if(r=[],i=[],!t(arguments[0],arguments[e]))return!1;return!0}function f(t){m(t)&&V(this,t)}function l(t){return setTimeout(t,4)}function h(){return Math.random().toString(36).substr(2)+Math.random().toString(36).substr(2)}function p(t,e,n){var r=e.split(".");return e=r[0],r=r[1],e in t.$$setters||(t.$$setters[e]={},E(t,e,function(t,e,n){var r=this;j(r.$$setters[e],function(){this.call(r,t,e,n)})})),t.$$setters[e][r||"observe"+h()]=n,t}function d(e){if(!t.ES5&&e in C)throw Error("If you want to support IE6/7/8. The property name ["+e+"] can not be observed, "+"because DOM has the same property name. "+"You can use the [jQuery.ES5 = true] to ignore IE6/7/8.")}var v=[],y=v.push,$=v.slice,g=Object.prototype.toString,m=function(t){return null==t?t:"[object Object]"===g.call(t)},b=Array.isArray||function(t){return"[object Array]"===g.call(t)},_=function(t){return"[object Function]"===g.call(t)},w=function(t){return"[object String]"===g.call(t)},O=t.trim,j=t.each,V=t.extend,P=t.inArray,S=Object.create||function(t){var e=function(){};return e.prototype=t,new e},x=/[^;]+/g,M=/[^:]+/g,N=/[^-]+/g;t.plus={attr:"js",viewModel:[]},o.init=function(t){this[0]=t,this.collect()},o.fn=o.init.prototype=o.prototype=V(S(t.fn),{rescan:function(){return this.clean().collect()},collect:function(t){var e=this;return s(t||this[0],function(t){return e.getAttr(t)}),this},clean:function(e){var n,r;for(r in this)this.hasOwnProperty(r)&&(n=this[r],n.removeAttr&&n.removeAttr(t.plus.attr),e&&delete this[r]);return this},getAttr:function(r){if(!/text/.test(r.nodeName)){var i=this,o=t(r),s=o.attr(t.plus.attr);return s&&j(n(s),function(t){var e=i.hasOwnProperty(t)&&i[t];e||(e=i[t]=u(),V(e,this)),e[e.length++]=r}),o.attr("noscan")!==e&&o.attr("app")&&r!==i[0]?!0:e}}});var A=t.plus.viewModel;t.fn.getVM=function(t){var e,n=this[0],r=n.viewIndex,i="number"==typeof r;return i&&!t?A[r]:(e=o(n),i?A.splice(r,1,e):(n.viewIndex=A.length,A.push(e)),e)},t.compare=c,f.prototype={each:j,extend:function(t){return V(this,t).refresh()},refresh:function(){var t=this;return t.each(t.model,function(e,n){e in t.vmodel&&t.render(e,n)}),t},render:function(e,n){var r,i,o,s=this.model,u=(this.oldModel,this.vmodel),f=u[e],l=f.method,h=f.args,p=l in t.fn,d=b(n),$=d?a(n):!1;if(!c(f.oldValue,n)){switch(f.oldValue=n,!0){case p&&d&&$:o=[],r=[],i=f.eq(0).clone(),p=t.fn[l],j(n,function(t){var e=f.eq(t);e.length||(e=i.clone(),r.push(e[0])),o.push(p.apply(e,h.concat(this)))}),r.length&&(f.eq(-1).after(r),y.apply(f,r));break;case p:o=t.fn[l].apply(f,h.concat(n));break;default:l=n,h=l.args||v,h=b(h)?h:[h],$=a(h),j(f,function(e){l.apply(t(this),$?h[e]:h)})}"listen"===l&&(s[e]=o)}}},t.fn.refresh=function(t){var n=this,r=new f;if(b(t)){var i=t.length;this.each(function(o){return o>=i?!1:(r.extend({model:t[o],vmodel:n.eq(o).getVM()}),e)})}else m(t)&&this.each(function(){r.extend({model:t,vmodel:n.getVM()})});return this};var E,k,I=document,q=I.getElementsByTagName("head")[0],C=I.createComment("Kill IE6/7/8"),G=/\[native code\]/,D="undefined",T={defineProperty:G.test(Object.defineProperty)&&G.test(Object.create)&&Object.defineProperty,__defineSetter__:G.test(Object.prototype.__defineSetter__)&&Object.prototype.__defineSetter__,__defineGetter__:G.test(Object.prototype.__defineGetter__)&&Object.prototype.__defineGetter__};!T.defineProperty&&T.__defineSetter__&&(T.defineProperty=function(t,e,n){T.__defineGetter__.call(t,e,n.get),T.__defineSetter__.call(t,e,n.set)}),T.defineProperty?(k=!0,E=function(t,e,n){var r=t[e]||D,i=!0,o=function(){n.call(t,r,e,t.$$oldValues[e]),t.$$oldValues[e]=r,i=!0,o=function(){var o=t.$$oldValues[e];i=!0,c(o,r)||(n.call(t,r,e,o),t.$$oldValues[e]=r)}};delete t[e],T.defineProperty(t,e,{get:function(){return r},set:function(t){r=t,i&&(i=!1,l(o))}})}):"onpropertychange"in q&&(E=function(t,n,r){var i;t.onpropertychange||(i={},t.onpropertychange=function(t){var n=this,o=(t||window.event).propertyName;if(o in this.$$setters)return i[o]===e?(i[o]=!0,r.call(n,n[o],o,n.$$oldValues[o]),n.$$oldValues[o]=n[o],e):(i[o]&&(i[o]=!1,l(function(){var t=n.$$oldValues[o];i[o]=!0,c(t,n[o])||(r.call(n,n[o],o,t),n.$$oldValues[o]=n[o])})),e)})});var Q={$$proto:{add:function(t,e){return this[t]=e||D,this.$$oldValues[t]="$.observe"+h(),this},remove:function(t){return delete this.$$oldValues[t],"onpropertychange"in this&&this.nodeName!==e?this.removeAttribute(t):delete this[t],this},on:function(){var t=this,e=$.call(arguments);return 1===e.length?(e=e[0],m(e)?j(e,function(e,n){d(e),p(t,e,n)}):_(e)&&t.each(function(n){d(n),p(t,n,e)})):2===e.length&&w(e[0])&&_(e[1])&&(d(e[0]),p(t,e[0],e[1])),this},off:function(){var t=this,e=$.call(arguments);return 0===e.length?j(t.$$setters,function(e){t.$$setters[e]={}}):e.length>=1&&j(e,function(){var e,n,r=this.indexOf(".");0===r?(n=this.substr(1),j(t.$$setters,function(){n in this&&delete this[n]})):r>0?(e=this.substr(0,r),n=this.substr(r+1),n in t.$$setters[e]&&delete t.$$setters[e][n]):this in t.$$setters&&(t.$$setters[this]={})}),this},each:function(t){var e=this;return j(e.$$oldValues,function(n){t.call(e,n,e[n])}),this},extend:function(){return V.apply(null,[this].concat($.call(arguments)))}},init:k?function(t){var e=S(this.$$proto),n=e.$$oldValues={};e.$$setters={};for(var r in t)t.hasOwnProperty(r)&&(n[r]=e[r]=t[r]);return e}:function(t){var e=q.appendChild(I.createComment("[object Object]")),n=e.$$oldValues={};V(e,this.$$proto).$$setters={};for(var r in t)t.hasOwnProperty(r)&&(n[r]=e[r]=t[r]);return e}};t.observe=function(t,e){var n;return m(t)?(n=Q.init(t),m(e)||_(e)?n.on(e):n):null},V(t.fn,{render:function(e){function n(t,e){var n=i[t];n&&n[b(e)?"apply":"call"](r,e)}var r=this,i=t.fn;return m(e)?j(e,n):b(e)&&j(e,function(){j(this,n)}),this},listen:function(e){var n=this;return n.refresh(e),t.observe(e).on(function(t,e){var r={};r[e]=t,n.refresh(r)})}}),t.define=function(e,n){var r,i=t(e);if(i.length)return r={},r=n(r)||r,i.listen(r)},t.render=function(e){return t("[render]").each(function(){var n,r=t(this),i=r.attr("render");i in e&&m(n=e[i])&&r.render(n)}),this};var R={vmodel:{},ready:function(e){var n=this;return t(document).ready(function(){e.call(n.$scan())}),this},$scan:function(){var e=this;return t("[app]").each(function(){var n=t(this),r=n.attr("app"),i=!1;e.vmodel[r]=n.getVM(),e.on(r+".module",function(t,e){!i&&m(t)&&(i=!0,this[e]=n.listen(t),i=!1)})}),this}};t.module=V(t.observe({}),R)})(window.jQuery||window.Zepto);