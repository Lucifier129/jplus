/* jplus 2014-10-09 */
(function(t,e){"use strict";function n(t){return i(r(t))}function r(t){var e=m(t).match(S);return b(e,function(t,n){var r=e[t]=m(n).match(N);r[0]=m(r[0]),r[1]&&(r[1]=m(r[1])),-1!==r[0].indexOf("-")&&(r[0]=m(r[0]).match(E))})}function i(e){var n={};return b(e,function(){var e=this;switch(!0){case 1===e.length:n[e[0]]={};break;case O(e[0]):n[e[1]]={method:e[0][0],args:e[0].slice(1)};break;case e[0]in t.fn:n[e[1]]={method:e[0],args:y};break;default:n[e[0]]={method:x}}}),n}function o(t){return new o.init(t)}function s(t,e){if(!e(t))for(t=t.firstChild;t;)s(t,e),t=t.nextSibling}function u(){var e=V(t.fn);return e.length=0,e}function a(e){if(!O(e))return!1;var n,r,i=e.length;if(i>1){for(n=t.type(e[0]),r=i-1;r>=0;r--)if(t.type(e[r])!==n)return!1;return!0}return!1}function f(){function t(e,n){var o;if(isNaN(e)&&isNaN(n)&&"number"==typeof e&&"number"==typeof n)return!0;if(e===n)return!0;if("function"==typeof e&&"function"==typeof n||e instanceof Date&&n instanceof Date||e instanceof RegExp&&n instanceof RegExp||e instanceof String&&n instanceof String||e instanceof Number&&n instanceof Number)return""+e==""+n;if(!(e instanceof Object&&n instanceof Object))return!1;if(e.isPrototypeOf(n)||n.isPrototypeOf(e))return!1;if(e.constructor!==n.constructor)return!1;if(e.prototype!==n.prototype)return!1;if(r.indexOf(e)>-1||i.indexOf(n)>-1)return!1;for(o in n){if(n.hasOwnProperty(o)!==e.hasOwnProperty(o))return!1;if(typeof n[o]!=typeof e[o])return!1}for(o in e){if(n.hasOwnProperty(o)!==e.hasOwnProperty(o))return!1;if(typeof n[o]!=typeof e[o])return!1;switch(typeof e[o]){case"object":case"function":if(r.push(e),i.push(n),!t(e[o],n[o]))return!1;r.pop(),i.pop();break;default:if(e[o]!==n[o])return!1}}return!0}var e,n,r,i;if(1>arguments.length)return!0;for(e=1,n=arguments.length;n>e;e++)if(r=[],i=[],!t(arguments[0],arguments[e]))return!1;return!0}function c(t){j(t)&&_(this,t)}function h(t){return setTimeout(t,4)}function l(){return Math.random().toString(36).substr(2)+Math.random().toString(36).substr(2)}function p(t,e,n){var r=e.split(".");return e=r[0],r=r[1],e in t.$$setters||(t.$$setters[e]={},A(t,e,function(t,e,n){var r=this;b(r.$$setters[e],function(){this.call(r,t,e,n)})})),t.$$setters[e][r||"observe"+l()]=n,t}function d(e){if(t.ES5)return!0;if(e in I)throw Error("If you want to support IE6/7/8. The property name ["+e+"] can not be observed, "+"because DOM has the same property name. "+"You can use the [jQuery.ES5 = true] to ignore IE6/7/8.");return!0}function v(t){this.source=t}var y=[],$=y.push,g=y.slice,m=t.trim,b=t.each,_=t.extend,O=t.isArray,j=t.isPlainObject,w=t.isFunction,P=function(t){return"string"==typeof t},x=t.noop;Object.prototype.toString,t.data;var V=Object.create||function(t){var e=function(){};return e.prototype=t,new e},S=/[^;]+/g,N=/[^:]+/g,E=/[^-]+/g;o.init=function(t){this[0]=t},o.fn=o.init.prototype=o.prototype=_(V(t.fn),{rescan:function(){return this.clean().collect()},collect:function(t){var e=this;return s(t||this[0],function(t){return e.getAttr(t)}),this},clean:function(t){var e,n;for(n in this)this.hasOwnProperty(n)&&(e=this[n],e.removeAttr&&e.removeAttr("js"),t&&delete this[n]);return this},getAttr:function(r){if(!/text/.test(r.nodeName)){var i=this,o=t(r),s=o.attr("noscan"),a=o.attr("js");return a&&b(n(a),function(t){var e=i.hasOwnProperty(t)&&i[t];e||(e=i[t]=u(),_(e,this)),e[e.length++]=r}),s!==e&&r!==i[0]?!0:e}}}),t.fn.getVM=function(t){var e;return(t||!(e=this.data("vmodel")))&&(e=this.data("vmodel",o(this[0]).collect()).data("vmodel")),e},t.compare=f,c.prototype={each:b,extend:function(t){return _(this,t).refresh()},refresh:function(){var t=this;return t.each(t.model,function(e,n){e in t.vmodel&&t.render(e,n)}),t},render:function(e,n){var r,i,o,s=this.model,c=(this.oldModel,this.vmodel),h=this.repeat,l=c[e],p=l.method,d=l.args,v=p in t.fn,g=O(n),m=g?a(n):!1;if(!f(l.oldValue,n)){switch(l.oldValue=n,console.log(n),!0){case v&&g&&m:if(v=t.fn[p],o=[],h){if(r=[],i=l.eq(0),b(n,function(t){var e=l.eq(t);e.length||(e=i.clone(!0,!0),r.push(e[0])),o.push(v.apply(e,d.concat(this)))}),r.length){var _=u();$.apply(_,r),l.eq(-1).after(_),$.apply(l,r)}}else l.each(function(e){n[e]&&o.push(v.apply(t(this),d.concat(n[e])))});break;case v:o=t.fn[p].apply(l,d.concat(n));break;default:p=n,d=p.args||y,d=O(d)?d:[d],m=a(d),b(l,function(e){p.apply(t(this),m?d[e]:d)})}"listen"===p&&(s[e]=o)}}};var k=new c;t.fn.refresh=function(t,e){return k.extend({model:t,vmodel:this.getVM(),repeat:"boolean"==typeof e?e:!1}),this};var A,M,C=document,G=C.getElementsByTagName("head")[0],I=C.createComment("Kill IE6/7/8"),q=/\[native code\]/,D="undefined",T={defineProperty:q.test(Object.defineProperty)&&q.test(Object.create)&&Object.defineProperty,__defineSetter__:q.test(Object.prototype.__defineSetter__)&&Object.prototype.__defineSetter__,__defineGetter__:q.test(Object.prototype.__defineGetter__)&&Object.prototype.__defineGetter__};!T.defineProperty&&T.__defineSetter__&&(T.defineProperty=function(t,e,n){T.__defineGetter__.call(t,e,n.get),T.__defineSetter__.call(t,e,n.set)}),T.defineProperty?(M=!0,A=function(t,e,n){function r(){var r=t.$$oldValues[e];r!==i&&(n.call(t,i,e,r),t.$$oldValues[e]=i,o=!0)}var i=t[e]||D,o=!0;delete t[e],T.defineProperty(t,e,{get:function(){return i},set:function(t){i=t,o&&(o=!1,h(r))}})}):"onpropertychange"in G&&(A=function(t,n,r){var i;t.onpropertychange||(i={},t.onpropertychange=function(t){var n=this,o=(t||window.event).propertyName;o in this.$$setters&&(i[o]===e&&(i[o]=!0),i[o]&&(i[o]=!1,h(function(){var t=n.$$oldValues[o];t!==n[o]&&(r.call(n,n[o],o,t),n.$$oldValues[o]=n[o],i[o]=!0)})))})}),v.prototype={$$proto:{add:function(t,e){return this.$$oldValues[t]=this[t]=e||D,this},remove:function(t){return delete this.$$oldValues[t],"onpropertychange"in this&&this.nodeName!==e?this.removeAttribute(t):delete this[t],this},on:function(){var t=this,e=g.call(arguments);return 1===e.length?(e=e[0],j(e)?b(e,function(e,n){d(e)&&p(t,e,n)}):w(e)&&b(t.$$oldValues,function(n){d(n)&&p(t,n,e)})):2===e.length&&P(e[0])&&w(e[1])&&d(e[0])&&p(t,e[0],e[1]),this},off:function(){var t=this,e=g.call(arguments);return 0===e.length?b(t.$$setters,function(e){t.$$setters[e]={}}):e.length>=1&&b(e,function(){var e,n,r=this.indexOf(".");0===r?(n=this.substr(1),b(t.$$setters,function(){n in this&&delete this[n]})):r>0?(e=this.substr(0,r),n=this.substr(r+1),n in t.$$setters[e]&&delete t.$$setters[e][n]):this in t.$$setters&&(t.$$setters[this]={})}),this},each:function(t){var e=this;return b(e.$$oldValues,function(n){t.call(e,n,e[n])}),this},extend:function(){return _.apply(null,[this].concat(g.call(arguments)))}},init:M?function(){var t=this.source,e=V(this.$$proto),n=e.$$oldValues={},r="$.observe"+l();e.$$setters={};for(var i in t)n[i]=r;return _(e,t)}:function(){var t=this.source,e=G.appendChild(C.createComment("[object Object]")),n=e.$$oldValues={},r="$.observe"+l();e.$$setters={};for(var i in t)n[i]=r;return _(e,this.$$proto,t)}},t.observe=function(t){return new v(t).init()},t.fn.extend({render:function(e){if(j(e)){var n=this,r=t.fn;return b(e,function(t,e){var i=r[t];i&&i[O(e)?"apply":"call"](n,e)}),this}},listen:function(e){var n=this;return t.observe(e).on(function(t,e){var r={};r[e]=t,n.refresh(r,!0)}).extend(e)}}),t.module=function(e,n){var r,i=t(e);if(i.length)return r={},r=n(r)||r,i.listen(r)}})(jQuery||Zepto);