/* jplus 2014-10-08 */
(function(t){"use strict";function e(t,e){this.elem=t,this.callback=e,this.data={start:{},move:{}}}var n=document.createElement("div").style,i=["","-webkit-","-moz-","-ms-","-o-"],r=i.length,o=t.camelCase;t.css3fix=function(t){for(var e,a=0;r>a;a+=1)if(e=o(i[a]+t),e in n)return e;return!1};var a="ontouchstart"in document,s=a?{start:"touchstart",move:"touchmove",end:"touchend"}:{start:"mousedown",move:"mousemove",end:"mouseup"},c=function(t){return c="touches"in t?function(t){var e=t.touches[0];return{x:e.clientX,y:e.clientY}}:function(t){return{x:t.clientX,y:t.clientY}},c(t)},u=document.addEventListener?function(t,e,n){t.addEventListener(e,n,!1)}:function(t,e,n){t.attachEvent("on"+e,n)},l=document.removeEventListener?function(t,e,n){t.removeEventListener(e,n)}:function(t,e,n){t.detachEvent("on"+e,n)},h="function"==typeof window.setImmediate?function(t){window.setImmediate(t)}:function(t){window.setTimeout(t,0)};e.prototype={eventType:s,init:function(){return this.addSwipe()},addSwipe:function(){var t=this;return this.START=function(e){t.start.call(t,e)},u(this.elem,this.eventType.start,this.START),this},removeSwipe:function(){return l(this.elem,this.eventType.start,this.START),this},addEvent:function(e,n){return"string"==typeof e&&t.isFunction(n)&&(this.callback[e]=n),this},addDocEvent:function(){var t=this;this.MOVE=function(e){t.move.call(t,e)},this.END=function(e){t.end.call(t,e)},u(document,this.eventType.move,this.MOVE),u(document,this.eventType.end,this.END)},removeDocEvent:function(){l(document,this.eventType.move,this.MOVE),l(document,this.eventType.end,this.END)},preventDefault:function(t){"preventDefault"in(t=t||window.event)?t.preventDefault():t.returnValue=!1},start:function(t){var e=this,n=e.elem,i=e.data,r=e.callback,o=c(t);e.preventDefault(t),i.start.x=i.move.x=o.x,i.start.y=i.move.y=o.y,i.start.timeStamp=+new Date,i.start.begin=!0,i.start.dir=function(t,e){var n=Math.atan2(Math.abs(t),Math.abs(e))*(180/Math.PI);return i.start.dir=function(){return n},n},"start"in r&&r.start.call(n,t,i.start),h(function(){e.addDocEvent()})},move:function(t){var e=this.data,n=this.elem,i=this.callback,r=c(t);this.preventDefault(t),e.move.dir=e.start.dir(r.y-e.start.y,r.x-e.start.x),e.move.x=r.x-e.move.x,e.move.y=r.y-e.move.y,"move"in i&&i.move.call(n,t,e.move),e.move.x=r.x,e.move.y=r.y},end:function(t){var e=this.data,n=this.elem,i=this.callback;if(this.preventDefault(t),this.removeDocEvent(),e.start.begin=!1,e.end={x:e.move.x-e.start.x,y:e.move.y-e.start.y,t:+new Date-e.start.timeStamp,dir:{},stop:!1},220>e.end.t&&Math.max(Math.abs(e.end.x),Math.abs(e.end.y))>10){e.move.dir>30?e.end.dir[e.end.y>0?"down":"up"]=1:e.end.dir[e.end.x>0?"right":"left"]=1;for(var r in e.end.dir)r in i&&(e.end.stop=!0,i[r].call(n,t,e.end))}else if(200>e.end.t&&10>Math.max(Math.abs(e.end.x),Math.abs(e.end.y))){if("tap"in i){if(a){var o=t.target;"A"===o.nodeName?setTimeout(function(){o.click()},0):"A"===o.parentNode.nodeName&&setTimeout(function(){o.parentNode.click()},0)}i.tap.call(n,t,e)}}else!e.end.stop&&"end"in i&&i.end.call(n,t,e.end,e.move)}},t.fn.swipe=function(n){return n&&t.isPlainObject(n)?this.each(function(){t(this).data("swipe",new e(this,n).init())}):this};var f,d,p=t.css3fix("transform"),v=t.css3fix("transition");p&&v?(f={setX:function(t,e){t.style[p]="translateX("+e+"px)"},setY:function(t,e){t.style[p]="translateY("+e+"px)"},animateX:function(e,n,i){t(e).addClass("transi-for-swipeshow"),f.setX(e,n),setTimeout(i,400)},animateY:function(e,n,i){t(e).addClass("transi-for-swipeshow"),f.setY(e,n),setTimeout(i,400)}},d=document.createElement("style"),d.type="text/css",d.innerHTML=".transi-for-swipeshow { -webkit-transition: all .4s ease-out; -moz-transition: all .4s ease-out; transition: all .4s ease-out;}",document.getElementsByTagName("head")[0].appendChild(d)):f={setX:function(t,e){t.style.marginLeft=e+"px"},setY:function(t,e){t.style.marginTop=e+"px"},animateX:function(e,n,i){t(e).animate({marginLeft:n},400,i)},animateY:function(e,n,i){t(e).animate({marginTop:n},400,i)}},t.fn.swipeshow=function(e){var n={dir:"x",className:"cur",speed:3e3,auto:!0,type:"click"};t.extend(n,e),n.dir=n.dir.toUpperCase();var i,r,o=this,a=f["set"+n.dir],s=f["animate"+n.dir],c=o.parent(),u=o.children(),l=u.length,h=c.width(),d=c.height(),p=c.css("position"),m=/x/i.test(n.dir),_=[],y=!0;if(1>=l)return this;2===l&&(u.each(function(){o.append(t(this).clone(!0))}),u=o.children(),l=4,r=!0),u.each(function(){_.push(t(this))}),i=m?h:d,e=n.opts?t(n.opts).children():null,c.css({position:/absolute|fixed|relative/.test(p)?c.css("position"):"relative",overflow:"hidden"}),u.css({"float":"left",width:h,height:d}),o.css({position:"absolute",top:0,left:0,width:m?h*l:h,height:m?d:d*l}).on("click","a",function(t){y?t.preventDefault():y=!0});var b,g,x=0,w=0,k=0,T=o[0],E=!0,M=null,V={check:function(t){var e=t-x;return t>x?(k-=e,k=0>k?k+l:k):x>t&&(k=(k-e)%l),x=t,w=x*i,this},callback:function(){var t=!1;0===x?(x=-1,o.children().last().prependTo(o),t=!0):x===1-l&&(x=2-l,o.children().first().appendTo(o),t=!0),t&&(w=x*i,a(v?o.removeClass("transi-for-swipeshow")[0]:T,w)),E=!0},slide:function(){return E=!1,s(T,w,this.callback),e&&(r?e.removeClass(n.className).eq(k%2).add(e.eq(k)).addClass(n.className):e.eq(k).addClass(n.className).siblings().removeClass(n.className)),this},normal:function(){E&&(V.check(Math.round(w/i)).slide(),n.callback&&n.callback.call(o,r?k%2:k))},next:function(){return E?(V.check(x-1).slide(),n.callback&&n.callback.call(o,r?k%2:k),this):this},prev:function(){E&&(V.check(x+1).slide(),n.callback&&n.callback.call(o,r?k%2:k))}}.check(0).slide();return o.swipe({tap:function(){y=!1,V.normal()},start:function(){E&&o.removeClass("transi-for-swipeshow")},move:function(t,e){E&&(w+=e[n.dir.toLowerCase()],a(T,w))},end:V.normal,up:m?V.normal:V.next,down:m?V.normal:V.prev,left:m?V.next:V.normal,right:m?V.prev:V.normal}),e&&n.type&&(g=e.parent().on(n.type,e.get(0).nodeName.toLowerCase(),function(){E&&V.check(-_[t(this).index()].index()).slide()})),n.auto&&(b=function(t){t.preventDefault(),"mouseenter"===t.type?clearTimeout(M):V.loop()},V.loop=function(){M=setTimeout(function(){V.next().loop()},n.speed)},c.on("mouseenter mouseleave",b).data("hover",!0),g&&!g.parent().data("hover")&&g.on("mouseenter mouseleave",b),V.loop()),n.next&&(n.next=t(n.next),n.next.on("click",V.next),b&&n.next.parent().data("hover")||n.next.on("mouseenter mouseleave",b)),n.prev&&(n.prev=t(n.prev),n.prev.on("click",V.prev),b&&n.prev.parent().data("hover")||n.prev.on("mouseenter mouseleave",b)),this}})(jQuery||Zepto);