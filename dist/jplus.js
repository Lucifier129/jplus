/* jplus 2014-12-08 */
!function(t,e){function n(t){return function(){return Function.prototype.call.apply(t,arguments)}}function r(t){return function(e){return null==e?e:d(e)==="[object "+t+"]"}}function i(n,r,i,o){if(n==e||!j(r))return n;var s,a=n.length;if(a===+a&&a>0&&!o){for(var u=0;a>u;u+=1)if(s=r.call(i||t,n[u],u,n),s!==e)return s;return n}for(var f in n)if(y(n,f)&&(s=r.call(i||t,n[f],f,n),s!==e))return s;return n}function o(){var t,e=arguments[0];if("boolean"==typeof e&&(t=e,e=arguments[1]),"object"!=typeof e&&!j(e))return e;var n=b(arguments,t?2:1);return i(n,function(n){"object"==typeof n&&i(n,function(n,r){if(t&&"object"==typeof n){var i=e[r];return e[r]="object"==typeof i?i:{},o(t,e[r],n)}e[r]=n})}),e}function s(t){if(!w(t))return!1;var e,n,r=t.length;if(r>1){for(e=d(t[0]),n=r-1;n>=0;n--)if(d(t[n])!==e)return!1;return!0}return!1}function a(e,n,r){return e[w(n)?"apply":"call"](r||t,n)}function u(t){var e;return j(t)?(e=A(t.prototype),e=t.apply(e,b(arguments,1))||e):e="object"==typeof t?t:{},e}function f(n){var r=f.instance,u=f.alias,c={};return i(n,function(t,n){var f,h=r[n];h===e&&n in u&&(h=r[n=u[n]]),j(h)?s(t)?(c[n]=[],i(t,function(t){f=a(h,t,r),f!==e&&c[n].push(f)})):(f=a(h,t,r),f!==e&&(c[n]=f)):"object"==typeof h&&"object"==typeof t?o(h,t):r[n]=t},t,!0),c}function c(){var n=u.apply(t,arguments),r=A(c.alias);return o(function(t){if(t===e)return n;var o;return f.instance=n,f.alias=r,w(t)?(o=[],i(t,function(t){"object"==typeof t&&o.push(f(t))})):"object"==typeof t&&(o=f(t)),o},{alias:r})}function h(t){return t+Math.random().toString(36).substr(2)}function l(t){if(!C.ES5&&t in k)throw Error("If you want to support IE6/7/8. The property name ["+t+"] can not be observed, "+"because DOM has the same property name. "+"You can use the [observe.ES5 = true] to ignore IE6/7/8.")}function v(t){this.$startNode=t,this.viewModel={}}function p(t,e,n){this.dataModel=t,this.viewModel=e,this.startNode=n}var _=Object.prototype,d=n(_.toString),y=n(_.hasOwnProperty),b=n(Array.prototype.slice),g=r("Object"),m=r("String"),j=r("Function"),w=Array.isArray||r("Array");if(!String.prototype.trim){var O=/^[\s\uFEFF\xA0]+|[\s\uFEFF\xA0]+$/g;String.prototype.trim=function(){return this.replace(O,"")}}var x={keys:Object.keys||function(t){if(!g(t))return[];var e=[];for(var n in t)y(t,n)&&e.push(n);return e},values:function(t){for(var e=this.keys(t),n=e.length,r=Array(n),i=0;n>i;i+=1)r[i]=t[e[i]];return r},invert:function(t){for(var e={},n=this.keys(t),r=0,i=n.len;i>r;r++)e[t[n[r]]]=n[r];return e},parse:function(t){if(!m(t))return{};var n={},r=t.trim().split(";");return i(r,function(t){return t=t.trim().split(":"),2>t.length?n[t[0]]="":(n[t[1].trim()]=t[0].trim(),e)}),n}},A=Object.create||function(t){var e=function(){};return e.prototype=t,new e};c.alias=A({extend:function(t){return o(this,t)},each:function(t){return i(this,t)},keys:function(){return x.keys(this)},values:function(){return x.values(this)},invert:function(){return x.invert(this)},parse:function(t){return this.extend(x.parse(t))}});var E=function(t){return setTimeout(t,4)},M=function(t,e,n,r){if(t===e)return 0!==t||1/t===1/e;if(null==t||null==e)return t===e;var i=d(t);if(i!==d(e))return!1;switch(i){case"[object RegExp]":case"[object String]":return""+t==""+e;case"[object Number]":return+t!==+t?+e!==+e:0===+t?1/+t===1/e:+t===+e;case"[object Date]":case"[object Boolean]":return+t===+e}var o="[object Array]"===i;if(!o){if("object"!=typeof t||"object"!=typeof e)return!1;var s=t.constructor,a=e.constructor;if(s!==a&&!(j(s)&&s instanceof s&&j(a)&&a instanceof a)&&"constructor"in t&&"constructor"in e)return!1}for(var u=n.length;u--;)if(n[u]===t)return r[u]===e;n.push(t),r.push(e);var f,c;if(o){if(f=t.length,c=f===e.length)for(;f--&&(c=M(t[f],e[f],n,r)););}else{var h,l=x.keys(t);if(f=l.length,c=x.keys(e).length===f)for(;f--&&(h=l[f],c=y(e,h)&&M(t[h],e[h],n,r)););}return n.pop(),r.pop(),c};x.isEqual=function(t,e){return M(t,e,[],[])};var N,S=document,$=S.getElementsByTagName("head")[0],k=S.createComment("Kill IE6/7/8"),F=/\[native code\]/;Array.prototype.indexOf||(Array.prototype.indexOf=function(t){for(var e=this.length-1;e>=0;e--)if(this[e]===t)return e;return-1});var I;F.test(Object.defineProperty)&&F.test(Object.create)?I=Object.defineProperty:F.test(Object.prototype.__defineSetter__)&&(I=function(t,e,n){t.__defineGetter__(e,n.get),t.__defineSetter__(e,n.set)});var V;I?(N=!0,V=function(t,e){function n(){i(t.__events__[e],function(n){i(n,function(n){n.call(t,s,e,a)})}),a="object"==typeof s?w(s)?s.concat():o(!0,{},s):s,r=!1}if(!(e in t.__events__)){var r,s=t[e],a="object"==typeof s?w(s)?s.concat():o(!0,{},s):s;I(t,e,{get:function(){return s},set:function(t){s=t,r||x.isEqual(t,a)||(r=!0,E(n))}})}}):"onpropertychange"in $&&(V=function(t){function e(e,s){var a=n[e],u=t[e];x.isEqual(u,a)||(i(s,function(n){i(n,function(n){n.call(t,u,e,a)})}),n[e]="object"==typeof u?w(u)?u.concat():o(!0,{},u):u,r[e]=!1)}if(!t.onpropertychange){var n={},r={};t.each(function(t,e){n[e]=g(t)?o(!0,{},t):w(t)?t.concat():t}),t.onpropertychange=function(t){t=t||window.event;var n=t.propertyName,i=this.__events__;if(n in i){if(r[n])return;r[n]=!0,E(function(){e(n,i[n])})}}}});var q={_add:function(t,e,n){return l(t),V(this,t),n=n||h("observer"),this.__events__[t]=this.__events__[t]||{},this.__events__[t][n]=this.__events__[t][n]||[],this.__events__[t][n].push(e),this},on:function(){var t,e=this,n=b(arguments),r=n.length;if(1===r)g(t=n[0])?i(t,function(t,n){e.on(n,t)}):j(t)&&this.each(function(n,r){e._add(r,t,"__all__")});else if(2===r){if(!j(n[1]))return this;if(m(t=n[0])){var o=t.indexOf(".");0>=o?this._add(t,n[1]):this._add(t.substr(0,o),n[1],t.substr(o+1))}else w(t)&&i(t,function(t){e.on(t,n[1])})}return this},_bang:function(t,e,n){var r=this,o=r[t];i(this.__events__[t][n]||[],function(n){n.call(r,e,t,o)})},trigger:function(t,e){var n,r=this;return t?(m(t)?(n=t.indexOf("."),n>0?this._bang(t.substr(0,n),e,t.substr(n+1)):n?i(this.__events__[t]||[],function(n,i){r._bang(t,e,i)}):(t=t.substr(1),i(this.__events__,function(n,o){i(n,function(n,i){i===t&&r._bang(o,e,i)})}))):w(t)&&i(t,function(t){r.trigger(t,e)}),this):this},_remove:function(t,e,n){var r=this.__events__[t][n]||[],i=r.indexOf(e);return-1!==i&&r.splice(i,1),this},off:function(){var t,e,n=this,r=b(arguments),o=r.length;if(o){if(1===o)j(t=r[0])?i(this.__events__,function(e,r){i(e,function(e,i){n._remove(r,t,i)})}):m(t)&&(e=t.indexOf("."),0>=e?this.__events__[t]={}:delete this.__events__[t.substr(0,e)][t.substr(e+1)]);else if(2===o){if(!j(r[1]))return this.off(r[0]),this;m(t=r[0])?(e=t.indexOf("."),0>=e?i(this.__events__[t],function(e,i){n._remove(t,r[1],i)}):this._remove(t.substr(0,e),r[1],t.substr(e+1))):w(t)&&i(t,function(t){n.off(t,r[1])})}}else this.__events__={};return this},offAll:function(){var t=this;return i(this.__events__,function(e,n){t.off([n,"__all__"].join("."))}),this},each:function(t){var e=this;if(this.nodeName)for(var n in this)-1!==e.filter.indexOf(n)||n in k||t.call(e,this[n],n);else i(this,function(n,r){-1===e.filter.indexOf(r)&&t.call(e,n,r)});return this},extend:function(){return o.apply(t,[this].concat(b(arguments)))},once:function(t,e){function n(){e.apply(r,arguments),r.off(t)}var r=this;return t+=".once",this.on(t,n)},tie:function(t,e){if(!j(e))return this;if(w(t)){var n=this,r=t.length,o=[],s=[],a=function(a,u){0>o.indexOf(u)?(o.push(u),o.length===r&&(i(t,function(t,e){t=t.split(".")[0],s[e]=n[t]}),e.apply(n,s))):o.length>=r&&(o.length=0,o.push(u))};return this.on(t,a)}return m(t)?this.on(t,e):this}};q.bind=q.on,q.unbind=q.off,q.fire=q.trigger,q.filter=x.keys(q).concat(["__events__","filter"]);var C=N?function(t,e){if(!g(t))return{};var n=o(A(q),t,{__events__:{}});return g(e)||j(e)?n.on(e):n}:function(t,e){if(!g(t))return{};var n=o($.appendChild(S.createComment("[object Object]")),q,t,{__events__:{}});return g(e)||j(e)?n.on(e):n};C.ES5=!1,C.fn=q;var B=window.jQuery||window.Zepto;if(B===e)return j(t.define)&&(define.amd||define.cmd)?define({agent:c,observe:C}):(t.agent=c,t.observe=C,t.$$===e&&(t.$$=c)),e;B.agent=c,B.observe=C;var D=B.plus={attr:"js",filterAttr:["noscan","app"],debug:!1,viewModel:[]},P=n(Array.prototype.push);v.prototype={filter:function(t){var e=[],n=this.$startNode[0],r=n.id=n.id||"filter_id_for_scaner";return i(D.filterAttr,function(t){var n=B([r,"["+t+"]","["+D.attr+"]"].join(" "));e.push.apply(e,b(n))}),"filter_id_for_scaner"===r&&(n.removeAttribute?n.removeAttribute("id"):n.id=""),t.filter(function(){return-1===e.indexOf(this)})},parse:function(t){var n=this.viewModel;return i(x.parse(t.attr(D.attr)),function(r,i){var o=n[i]=n[i]||{};o.instance?P(o.instance,t[0]):(r=r.split("-"),o.method=r[0],o.params=r.slice(1),o.instance=t,o.lastValue=null,o.alive=t.attr("unalive")!==e?!1:!0,o.template=t.clone())}),this},scan:function(){var t=this;return this.parse(this.$startNode).filter(this.$startNode.find("["+D.attr+"]")).each(function(){var e=B(this);e.prevObject=e.context=null,t.parse(e)}),this},rescan:function(){return this.viewModel={},this.scan()},get:function(){return this.viewModel}},B.fn.scanView=function(){var t=new v(this);if(B.plus.debug){var e=this[0];D.viewModel[e.vmIndex="number"==typeof e.vmIndex?e.vmIndex:D.viewModel.length]=t}return t.scan().get()};var T=B.fn;p.prototype={refresh:function(){var t=this.viewModel,e=this.dataModel;for(var n in e)n in t&&this.render(t[n],e[n],n)},render:function(t,e){if(!x.isEqual(e,t.lastValue)){t.lastValue="object"==typeof e?w(e)?e.concat():o(!0,{},e):e;var n=t.instance,r=t.method,i=t.params;if(t.method in T)if(r=T[r],s(e)){var a,u,f=n.length,c=e.length;if(t.alive)if(f>=c)for(n.slice(c).remove(),u=0;c>u;u+=1)a=B(n[u]),r.apply(a,i.concat(e[u]));else{var h=t.template,l=S.createDocumentFragment();for(u=0;c>u;u+=1)a=f>u?B(n[u]):h.clone().each(function(){P(n,l.appendChild(this))}),r.apply(a,i.concat(e[u]));if(l.childNodes.length){var v,p=n[f-1];(v=p.nextSibling)?p.parentNode.insertBefore(l,v):p.parentNode.appendChild(l)}h=l=null}else{var _=Math.min(f,c);for(u=0;_>u;u+=1)a=B(n[u]),r.apply(a,i.concat(e[u]))}}else r.apply(n,i.concat(e));else{if(!j(e))return;r=e,i=this.dataModel[t.method],r.apply(n,[].concat(i||[]))}}}},B.fn.refresh=function(t){var e=this,n=this[0];return g(t)?new p(t,this.scanView(),n).refresh():w(t)&&i(t,function(t,r){new p(t,e.eq(r).scanView(),n).refresh()}),this},o(B.fn,{render:function(t){function e(t,e){var i=r[e];j(i)&&i[w(t)?"apply":"call"](n,t)}var n=this,r=B.fn;return g(t)?i(t,e):w(t)&&i(t,function(t){g(t)&&i(t,e)}),this},listen:function(t){var e=this;return e.refresh(t),B.observe(t,function(t,n){var r={};r[n]=t,e.refresh(r)})}}),B.define=function(t,n){var r,i=B(t);return i.length?(r={},r=n(r)||r,i.listen(r)):e},B.render=function(t){return B("[render]").each(function(){var e,n=B(this),r=n.attr("render");r in t&&g(e=t[r])&&n.render(e)}),this};var G={vmodel:{},ready:function(t){var e=this;return B(document).ready(function(){t.call(e.$scan())}),this},$scan:function(){var t=this;return B("[app]").each(function(){var e=B(this),n=e.attr("app"),r=!1;t.vmodel[n]=e.scanView(),t.on(n+".module",function(t,n){!r&&g(t)&&(r=!0,this[n]=e.listen(t),r=!1)})}),this}};B.module=B.observe(G)}(this);